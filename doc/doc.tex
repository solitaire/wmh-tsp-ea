\documentclass[12pt, a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{polski}
\usepackage{hyperref}
\usepackage{float}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{geometry}
\usepackage[table]{xcolor}
\title{\textbf{Zastosowanie algorytmu ewolucyjnego do rozwiązywania problemu komiwojażera}}
\author{Anna Stępień \\ Adam Stelmaszczyk}
\date{\today}
\setlength{\parindent}{0in}
\makeatletter\renewcommand{\ALG@name}{}

\begin{document}
\maketitle

\section{Zadanie}
Celem zadania jest zaprojektowanie algorytmu ewolucyjnego, który zostanie wykorzystany do rozwiązania problemu komiwojażera.
Przedstawiona została reprezentacja rozwiązania, metoda sukcesji oraz operatory mutacji i krzyżowania. 
Z punktu widzenia przydatności projektowanego algorytmu, istotne jest przetestowanie go dla różnych parametrów, w szczególności dla:
\begin{itemize}
	\item różnych wartości prawdopodobieństwa mutacji $p_m$ i krzyżowania $p_c$,
	\item grafów o różnej liczbie wierzchołków $d$.
\end{itemize}

\section{Założenia}
Aplikacja będzie pracować w trybie konsolowym. Na standardowe wejście podawane będą pliki tekstowe zawierające opis grafów.
Program będzie wypisywał odpowiedź na standardowe wyjście.

\subsection{Reprezentacja rozwiązań}

Wierzchołki grafu numerujemy od 0 do $d - 1$. $d > 2$. Rozwiązanie reprezentujemy jako ciąg długości $d$, złożony z unikalnych liczb. 
Dla skrócenia zapisu stosujemy zapis 123, zamiast $(1,2,3)$. 
Przykładowo, w grafie pełnym o 3 wierzchołkach możliwych jest $3!$ rozwiązań: 123, 132, 213, 231, 312, 321.
Warto zauważyć, że połowę tych rozwiązań można pominąć, ze względu na to, że koszt przejścia z $a$ do $b$ jest zawsze 
taki sam jak z $b$ do $a$. Można zatem pominąć rozwiązania $231, 312, 321$. Pozostałe trzy rozwiązania mają identyczny koszt,
zatem dwa z nich również można pominąć. Tym samym jedyne interesujące nas rozwiązanie to $123$.
W ogólnym przypadku, dla grafu pełnego o $d$ wierzchołkach, liczba interesujących nas rozwiązań wynosi $\frac{(d-1)!}{2}$. 
Spośród redundantnych rozwiązań pozostawiane będą te, których reprezentacja liczbowa jest najmniejsza. 
Przykładowo, dla grafu pełnego o $4$ wierzchołkach zamiast rozpatrywać wszystkie
24 rozwiązania, będziemy rozpatrywać tylko 3: 1234, 1324, 1342. 
Minimalizowana wartość funkcji celu $f$ to suma wag krawędzi w cyklu dla danego rozwiązania.

\subsection{Schemat algorytmu ewolucyjnego}

\begin{algorithm}[!htb]
\label{ea}
\begin{algorithmic}[1]
\Function{algorytm\_ewolucyjny}{}
	\State $P(0) \gets \{x_1, x_2, \ldots, x_n\}$
	\State $t \gets 0$
	\While{$! stop$}
    	\For{$i = 0$ \bf{to} $i = n - 1$}
    		\If{$\mathcal{U}(0, 1) < p_c$}
    			\State $O(t,i) \gets$ mutacja$($krzy{\.z}owanie$($selekcja$(P(t), 2)))$
    		\Else
    			\State $O(t,i) \gets$ mutacja$($selekcja$(P(t),1))$
    		\EndIf
    	\EndFor
    \State $P(t+1) \gets$ sukcesja$(P(t),O(t))$
    \State $t \gets t+1$
  	\EndWhile
\EndFunction
\end{algorithmic}
\end{algorithm}

\subsection{Operator mutacji}

Operator mutacji otrzymuje na wejściu prawdopodobieństwo mutacji $p_m$ oraz rozwiązanie długości $d$.
Zwraca rozwiązanie długości $d$, nazywane mutantem.

\begin{enumerate}
 \item Utwórz początkowego mutanta kopiując rozwiązanie wejściowe.
 \item Liczba powtórzeń $R = \lceil d \cdot  p_m \rceil$. Powtórz $R$ razy następujące kroki:
 \item Wylosuj dwa różne indeksy $i, j$ od 0 do $d-1$ zgodnie z rozkładem jednostajnym.
 \item Zamień liczbę na pozycji $i$-tej z liczbą na pozycji $j$-tej w mutancie.
\end{enumerate}

\subsection{Operator krzyżowania}

Operator krzyżowania na wejściu otrzymuje dwa rozwiązania rodzicielskie długości $d$ i zwraca dwa rozwiązania potomne długości $d$. 
Jako operator krzyżowania zostanie wykorzystany operator krzyżowania z częściowym odwzorowaniem -- PMX
(ang. partially mapped crossover).
\begin{enumerate}
 \item Wylosuj dwa różne indeksy $i, j$ od 0 do $d-1$ zgodnie z rozkładem jednostajnym.
 \item Utwórz dwa rozwiązania potomne poprzez skopiowanie rozwiązań rodzicielskich, a następnie dokonaj wymiany rozwiązania dla sekwencji od $i$ do $j$.
 \item Na podstawie skopiowanej sekwencji od $i$ do $j$ utwórz wzajemne odwzorowanie rozwiązań rodzicielskich.
 \item Dokonaj ewentualnej korekty pozostałych części rozwiązania (od $0$ do $i-1$ oraz od $j+1$ do $d-1$). 
Korekta jest konieczna, gdy w rozwiązaniu potomnym co najmniej jeden z wierzchołków jest powtórzony.
Proces korekty przebiega następująco:
 \begin{enumerate}
 	\item Zidentyfikuj powtórzone wierzchołki w rozwiązaniu potomnym.
 	\item Dla każdego powtórzonego wierzchołka w części rozwiązania od $0$ do $i-1$ oraz od $j+1$ do $d-1$ 
dokonaj zamiany z wierzchołkiem zgodnym z odwzorowaniem uzyskanym wcześniej.
 \end{enumerate}
\end{enumerate}

Przykład: \\

Wejściowe rozwiązania rodzicielskie: \\

Rodzic 1
\begin{tabular}{ | c | c | c | c | c | c | c | c |}
  \hline
  2 & 6 &  \cellcolor{green!25}7 & \cellcolor{green!25}1 & \cellcolor{green!25}5 & \cellcolor{green!25}4 & 8 & 3 \\ \hline
\end{tabular}\\
Rodzic 2
\begin{tabular}{ | c | c | c | c | c | c | c | c |}
  \hline
  7 & 5 & \cellcolor{blue!25}6 & \cellcolor{blue!25}3 & \cellcolor{blue!25}8 & \cellcolor{blue!25}2 & 1 & 4 \\ \hline
\end{tabular}

\begin{enumerate}
 \item Wylosowano $i = 2$, $j = 5$.

 \item Wymiana sekwencji od $i$ do $j$. \\

Potomek 1
\begin{tabular}{ | c | c | c | c | c | c | c | c |}
  \hline
  2 & 6 & \cellcolor{blue!25}6 & \cellcolor{blue!25}3 & \cellcolor{blue!25}8 & \cellcolor{blue!25}2 & 8 & 3 \\ \hline
\end{tabular}\\
Potomek 2
\begin{tabular}{ | c | c | c | c | c | c | c | c |}
  \hline
  7 & 5 &  \cellcolor{green!25}7 & \cellcolor{green!25}1 & \cellcolor{green!25}5 & \cellcolor{green!25}4 & 1 & 4 \\ \hline
\end{tabular}\\

\item Utworzenie odwzorowania. \\\\
$6 - 7$\\
$3 - 1$\\
$5 - 8$\\
$2 - 4$\\

\item Korekta potomków. W potomku pierwszym: 2 się powtarza. Zgodnie z odwzorowaniem zostaje zamieniona na 4.
6 się powtarza, zostaje zamieniona na 7. 8 się powtarza, zamiana na 5. 3 się powtarza, zamiana na 1. \\

Potomek 1
\begin{tabular}{ | c | c | c | c | c | c | c | c |}
  \hline
  4 & 7 & \cellcolor{blue!25}6 & \cellcolor{blue!25}3 & \cellcolor{blue!25}8 & \cellcolor{blue!25}2 & 5 & 1 \\ \hline
\end{tabular}\\
Potomek 2
\begin{tabular}{ | c | c | c | c | c | c | c | c |}
  \hline
  6 & 8 &  \cellcolor{green!25}7 & \cellcolor{green!25}1 & \cellcolor{green!25}5 & \cellcolor{green!25}4 & 3 & 2 \\ \hline
\end{tabular}\\
\end{enumerate}

\subsection{Metoda sukcesji}

Metoda sukcesji na wejściu otrzymuje dwie populacje o rozmiarze $n$: aktualną $P$ oraz populację mutantów $O$.
Wyjściem jest jedna populacja o rozmiarze $n$.

\begin{algorithm}[!htb]
\begin{algorithmic}[1]
\Function{sukcesja}{}
  \For{$i = 0$ \bf{to} $i = n - 1$}
    \If{$f(O(t, i)) < f(P(t, i)) $}
      \State $P(t+1, i) \gets O(t, i)$
    \Else
      \State $P(t+1, i) \gets P(t, i)$
    \EndIf
  \EndFor
\EndFunction
\end{algorithmic}
\end{algorithm}

\nocite{*}
\bibliographystyle{plain}
\bibliography{references}
\end{document}
